<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RentEstate | Property</title>
  <link rel="stylesheet" href="/stylesheets/property.css">
</head>

<body>
  <div class="card">
   
        <h2>
          <%= property.propertyType %> - <%= property.subCategory %>
        </h2>
       
        <p>Owner: <%= property.ownerName %>
        </p>
        <p>Price: <%= property.price %>
        </p>
        <p>Description: <%= property.description %>
        </p>
        <p>City: <%= property.city %>
        </p>
        <p>State: <%= property.state %>
        </p>
        <p>Carpet Area: <%= property.carpetArea %>
        </p>
        <p>Address: <%= property.address %>
        </p>
        <p>Ownership Type :<%= property.ownershipType %>
        </p>
        <p>Pet Policy: <%= property.petPolicy %>
        </p>
        <p>Furnished Status: <%= property.furnishedStatus %>
        </p>
        <p>Property Age: <%= property.propertyAge %>
        </p>
        <p>Amenities: <%= property.amenities %>
        </p>
        <p>Rented Out: <%= property.rentedOut ? 'Yes' : 'No' %>
        </p>
        <div>
          <p>
          <h3>Images:</h3><a>
            <img src="<%= property.image.path %>" alt="Property Image" class="card-img">
          </a></p>

        </div>
        <div>
          <form class="pay-form" action="/createOrder" method="POST">
            <input type="hidden" name="name" value="<%=property.propertyType%> <%=property.subCategory%>">
            <input type="hidden" name="price" value="<%=property.price%>">
            <input type="submit" value="PAY NOW" class="card-button">
          </form>
        </div>
     




  </div>
</body>

</html>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  $(document).ready(function(){
    $('.pay-form').submit(function(e){
      e.preventDefault();
  
      var formData = $(this).serialize();
  
      $.ajax({
        url:"/createOrder",
        type:"POST",
        data: formData,
        success:function(res){
          if(res.success){
            var options = {
              "key": ""+res.key_id+"",
              "amount": ""+res.amount+"",
              "currency": "INR",
              "name": ""+res.product_name+"",
              "image": "https://dummyimage.com/600x400/000/fff",
              "order_id": ""+res.order_id+"",
              "handler": function (response){
                alert("Payment Successfull");
                // window.open("/","_self")
              },
              "prefill": {
                "contact":""+res.contact+"",
                "name": ""+res.name+"",
                "email": ""+res.email+""
              },
              "theme": {
                "color": "#2300a3"
              }
            };
            var razorpayObject = new Razorpay(options);
            razorpayObject.on('payment.failed', function (response){
                alert("Payment Failed");
            });
            razorpayObject.open();
          }
          else{
            alert(res.msg);
          }
        }
      })
  
    });
  });  
</script>